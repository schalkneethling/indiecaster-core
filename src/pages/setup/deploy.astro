---
/**
 * Setup Wizard - Step 6: Deploy
 *
 * Completion page with deployment options and next steps
 */

import SetupLayout from '../../components/setup/SetupLayout.astro';
---

<SetupLayout title="Setup Complete!" currentStep={6}>
  <div class="completion-content">
    <div class="success-banner">
      <svg width="64" height="64" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
      </svg>
      <h2>Great work! Your podcast website is configured.</h2>
      <p>Your configuration has been saved. Now let's get your website live!</p>
    </div>

    <div class="config-summary" id="config-summary">
      <h3>Configuration Summary</h3>
      <div class="summary-grid">
        <!-- Will be populated by JavaScript -->
      </div>
    </div>

    <div class="next-steps">
      <h3>Next Steps</h3>

      <div class="step-card">
        <div class="step-number">1</div>
        <div class="step-content">
          <h4>Build Your Site</h4>
          <p>Generate the static files for your website:</p>
          <div class="code-block">
            <code>npm run build</code>
            <button class="copy-btn" data-copy="npm run build">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div class="step-card">
        <div class="step-number">2</div>
        <div class="step-content">
          <h4>Test Locally</h4>
          <p>Preview your site before deployment:</p>
          <div class="code-block">
            <code>npm run preview</code>
            <button class="copy-btn" data-copy="npm run preview">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div class="step-card">
        <div class="step-number">3</div>
        <div class="step-content">
          <h4>Choose Your Deployment Platform</h4>
          <p>Deploy your podcast website to any of these platforms:</p>

          <div class="deployment-options">
            <a href="https://docs.netlify.com/site-deploys/create-deploys/#deploy-with-git" target="_blank" rel="noopener noreferrer" class="deploy-card">
              <div class="deploy-logo netlify">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2z"/>
                </svg>
              </div>
              <div class="deploy-info">
                <strong>Netlify</strong>
                <span>Easy continuous deployment from Git</span>
              </div>
            </a>

            <a href="https://vercel.com/docs/deployments/git" target="_blank" rel="noopener noreferrer" class="deploy-card">
              <div class="deploy-logo vercel">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0L24 24H0L12 0z"/>
                </svg>
              </div>
              <div class="deploy-info">
                <strong>Vercel</strong>
                <span>Optimized for frontend frameworks</span>
              </div>
            </a>

            <a href="https://docs.github.com/en/pages/getting-started-with-github-pages" target="_blank" rel="noopener noreferrer" class="deploy-card">
              <div class="deploy-logo github">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                </svg>
              </div>
              <div class="deploy-info">
                <strong>GitHub Pages</strong>
                <span>Free hosting for your repository</span>
              </div>
            </a>

            <a href="https://pages.cloudflare.com/" target="_blank" rel="noopener noreferrer" class="deploy-card">
              <div class="deploy-logo cloudflare">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0z"/>
                </svg>
              </div>
              <div class="deploy-info">
                <strong>Cloudflare Pages</strong>
                <span>Fast global CDN deployment</span>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="resources">
      <h3>Helpful Resources</h3>
      <div class="resource-grid">
        <a href="/docs/GETTING-STARTED-FRESH-INSTALL.md" class="resource-card">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>
          <strong>Getting Started Guide</strong>
          <span>Complete setup documentation</span>
        </a>

        <a href="/docs/RSS-FEED-VALIDATION.md" class="resource-card">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <strong>RSS Feed Validation</strong>
          <span>Submit to podcast directories</span>
        </a>

        <a href="/docs/MEDIA-REQUIREMENTS.md" class="resource-card">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <polyline points="21 15 16 10 5 21"></polyline>
          </svg>
          <strong>Media Requirements</strong>
          <span>Image and audio specifications</span>
        </a>

        <a href="/docs/TESTING-CHECKLIST.md" class="resource-card">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 11 12 14 22 4"></polyline>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
          </svg>
          <strong>Testing Checklist</strong>
          <span>Pre-deployment testing guide</span>
        </a>
      </div>
    </div>

    <div class="final-actions">
      <button id="finish-btn" class="btn btn-primary">
        Finish Setup & Build Site
      </button>
      <a href="/" class="btn btn-secondary">
        View Homepage
      </a>
    </div>
  </div>

  <style>
    .completion-content {
      max-width: 700px;
    }

    .success-banner {
      text-align: center;
      padding: 2.5rem 2rem;
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-radius: 12px;
      margin-bottom: 2.5rem;
      border: 2px solid #10b981;
    }

    .success-banner svg {
      color: #059669;
      margin-bottom: 1rem;
    }

    .success-banner h2 {
      font-size: 1.5rem;
      color: #064e3b;
      margin-bottom: 0.5rem;
    }

    .success-banner p {
      font-size: 1.0625rem;
      color: #065f46;
      margin: 0;
    }

    .config-summary {
      background: #f9fafb;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2.5rem;
      border: 1px solid #e5e7eb;
    }

    .config-summary h3 {
      font-size: 1.125rem;
      margin-bottom: 1rem;
      color: #1f2937;
    }

    .summary-grid {
      display: grid;
      gap: 0.75rem;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 0.625rem;
      background: white;
      border-radius: 6px;
      font-size: 0.9375rem;
    }

    .summary-item strong {
      color: #1f2937;
    }

    .summary-item span {
      color: #6b7280;
    }

    .next-steps {
      margin-bottom: 2.5rem;
    }

    .next-steps h3 {
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
      color: #1f2937;
    }

    .step-card {
      display: flex;
      gap: 1.25rem;
      margin-bottom: 1.5rem;
      padding: 1.5rem;
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .step-card:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    }

    .step-number {
      width: 40px;
      height: 40px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: bold;
      border-radius: 50%;
      font-size: 1.125rem;
    }

    .step-content h4 {
      font-size: 1.0625rem;
      margin-bottom: 0.5rem;
      color: #1f2937;
    }

    .step-content p {
      color: #6b7280;
      margin-bottom: 0.75rem;
      font-size: 0.9375rem;
    }

    .code-block {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: #1f2937;
      padding: 0.75rem 1rem;
      border-radius: 6px;
      font-family: 'Monaco', 'Courier New', monospace;
      margin-bottom: 0.75rem;
    }

    .code-block:last-child {
      margin-bottom: 0;
    }

    .code-block code {
      flex: 1;
      color: #10b981;
      font-size: 0.9375rem;
    }

    .copy-btn {
      background: transparent;
      border: none;
      color: #9ca3af;
      cursor: pointer;
      padding: 0.25rem;
      display: flex;
      transition: color 0.2s;
    }

    .copy-btn:hover {
      color: #10b981;
    }

    .deployment-options {
      display: grid;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .deploy-card {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      text-decoration: none;
      transition: all 0.2s;
    }

    .deploy-card:hover {
      border-color: #667eea;
      background: white;
      transform: translateX(4px);
    }

    .deploy-logo {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .deploy-logo svg {
      width: 28px;
      height: 28px;
    }

    .deploy-logo.netlify {
      color: #00ad9f;
    }

    .deploy-logo.vercel {
      color: #000;
    }

    .deploy-logo.github {
      color: #24292e;
    }

    .deploy-logo.cloudflare {
      color: #f38020;
    }

    .deploy-info {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }

    .deploy-info strong {
      color: #1f2937;
      font-size: 0.9375rem;
    }

    .deploy-info span {
      color: #6b7280;
      font-size: 0.8125rem;
    }

    .resources {
      margin-bottom: 2.5rem;
    }

    .resources h3 {
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
      color: #1f2937;
    }

    .resource-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .resource-card {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: 1.25rem;
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      text-decoration: none;
      transition: all 0.2s;
    }

    .resource-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    }

    .resource-card svg {
      color: #667eea;
    }

    .resource-card strong {
      color: #1f2937;
      font-size: 0.9375rem;
    }

    .resource-card span {
      color: #6b7280;
      font-size: 0.8125rem;
    }

    .final-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      padding-top: 2rem;
      border-top: 1px solid #e5e7eb;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.875rem 1.75rem;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-family: inherit;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }

    .btn-secondary:hover {
      background: #f9fafb;
    }

    @media (max-width: 640px) {
      .resource-grid {
        grid-template-columns: 1fr;
      }

      .final-actions {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }

      .step-card {
        flex-direction: column;
      }
    }
  </style>

  <script>
    // Load and display configuration summary
    function loadConfigSummary() {
      const summaryGrid = document.querySelector('.summary-grid');
      if (!summaryGrid) return;

      const podcastInfo = localStorage.getItem('podcast-info');
      const hostInfo = localStorage.getItem('host-info');
      const socialLinks = localStorage.getItem('social-links');
      const episodeInfo = localStorage.getItem('episode-info');

      const items: string[] = [];

      if (podcastInfo) {
        try {
          const data = JSON.parse(podcastInfo);
          items.push(`
            <div class="summary-item">
              <strong>Podcast Name</strong>
              <span>${data.podcastName || 'Not set'}</span>
            </div>
          `);
          items.push(`
            <div class="summary-item">
              <strong>Domain</strong>
              <span>${data.domain || 'Not set'}</span>
            </div>
          `);
        } catch (e) {
          console.error('Failed to parse podcast info:', e);
        }
      }

      if (hostInfo) {
        try {
          const data = JSON.parse(hostInfo);
          items.push(`
            <div class="summary-item">
              <strong>Host Name</strong>
              <span>${data.hostName || 'Not set'}</span>
            </div>
          `);
        } catch (e) {
          console.error('Failed to parse host info:', e);
        }
      }

      if (socialLinks) {
        try {
          const data = JSON.parse(socialLinks);
          const count = Object.keys(data).length;
          items.push(`
            <div class="summary-item">
              <strong>Social Links</strong>
              <span>${count} platform${count !== 1 ? 's' : ''} connected</span>
            </div>
          `);
        } catch (e) {
          console.error('Failed to parse social links:', e);
        }
      }

      if (episodeInfo) {
        try {
          const data = JSON.parse(episodeInfo);
          if (data.title) {
            items.push(`
              <div class="summary-item">
                <strong>First Episode</strong>
                <span>${data.title}</span>
              </div>
            `);
          }
        } catch (e) {
          console.error('Failed to parse episode info:', e);
        }
      }

      if (items.length === 0) {
        summaryGrid.innerHTML = `
          <div class="summary-item">
            <strong>Configuration</strong>
            <span>Ready to build</span>
          </div>
        `;
      } else {
        summaryGrid.innerHTML = items.join('');
      }
    }

    // Copy to clipboard functionality
    document.querySelectorAll('.copy-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const text = btn.getAttribute('data-copy');
        if (text) {
          try {
            await navigator.clipboard.writeText(text);
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<span style="color: #10b981;">âœ“</span>';
            setTimeout(() => {
              btn.innerHTML = originalHTML;
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        }
      });
    });

    // Finish button - trigger build
    const finishBtn = document.getElementById('finish-btn');
    finishBtn?.addEventListener('click', () => {
      // In a real implementation, this would trigger the API to:
      // 1. Process all the localStorage data
      // 2. Write configuration files
      // 3. Trigger build process
      // For now, just show a message
      alert('Setup complete! Run "npm run build" in your terminal to build your site.');
    });

    // Load summary on page load
    loadConfigSummary();
  </script>
</SetupLayout>
